{"version":3,"file":"popup.js","mappings":";;;;;;;;;;;;;;;;;;;;;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA;AACO;AACP,+BAA+B,uBAAuB,WAAW;AACjE;AACA;AACO;AACP;AACA;AACA,KAAK;AACL;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C,OAAO;AACtD,iBAAiB;AACjB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,2GAA2G;AAClJ,mCAAmC,2GAA2G;AAC9I,+CAA+C,2GAA2G;AAC1J,kDAAkD,2GAA2G;AAC7J,2CAA2C;AAC3C,iBAAiB;AACjB,sCAAsC,OAAO,qBAAqB,KAAK;AACvE;AACA;AACA;AACA,iCAAiC,mCAAmC;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,4EAA4E;AACtI,gEAAgE,gBAAgB;AAChF,kEAAkE;AAClE,yCAAyC;AACzC;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA,0DAA0D,4EAA4E;AACtI,gEAAgE,gBAAgB;AAChF,kEAAkE;AAClE,yCAAyC;AACzC;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA,0DAA0D,4EAA4E;AACtI,gEAAgE,gBAAgB;AAChF,kEAAkE;AAClE,yCAAyC;AACzC;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA,0DAA0D,4EAA4E;AACtI,gEAAgE,gBAAgB;AAChF,kEAAkE;AAClE,yCAAyC;AACzC;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA,0DAA0D,4EAA4E;AACtI,gEAAgE,gBAAgB;AAChF,kEAAkE;AAClE,yCAAyC;AACzC;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,OAAO;AAC9D,yBAAyB;AACzB;AACA,qBAAqB;AACrB;AACA,+DAA+D,gBAAgB;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;;;;;;;UChOA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;ACNA,iBAAiB,SAAI,IAAI,SAAI;AAC7B,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AAC2J;AAC3J;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,uDAAS;AACb;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2EAA2E,KAAK;AAChF;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4EAA4E,4BAA4B;AACxG;AACA;AACA;AACA,gBAAgB,yDAAW;AAC3B;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,4DAAc;AACpD;AACA,oBAAoB,wDAAU;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,kCAAkC,mBAAmB;AACrD;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,QAAQ,yDAAW;AACnB,4BAA4B,mCAAmC;AAC/D;AACA;AACA;AACA;AACA,gBAAgB,yDAAW;AAC3B,uDAAuD,6CAA6C;AACpG;AACA;AACA,gBAAgB,yDAAW;AAC3B,sDAAsD,2CAA2C;AACjG;AACA,wBAAwB,4DAAc;AACtC,4BAA4B,yDAAW;AACvC,4BAA4B,yDAAW;AACvC;AACA,yDAAyD,kEAAoB;AAC7E;AACA;AACA;AACA,uEAAuE,wCAAwC;AAC/G;AACA,yBAAyB;AACzB,4BAA4B,yDAAW;AACvC,4BAA4B,yDAAW;AACvC,mEAAmE,uDAAuD;AAC1H,yBAAyB;AACzB;AACA;AACA,wBAAwB,yDAAW;AACnC,wBAAwB,yDAAW;AACnC,+DAA+D,2CAA2C;AAC1G;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA,QAAQ,uDAAS;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wFAAwF,QAAQ;AAChG,8FAA8F,QAAQ;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD,2BAA2B,EAAE,mBAAmB;AACtG;AACA;AACA;AACA,sDAAsD,2BAA2B,EAAE,kBAAkB;AACrG;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,uDAAS;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,QAAQ,yDAAW;AACnB,QAAQ,yDAAW;AACnB;AACA;AACA;AACA,QAAQ,yDAAW;AACnB,QAAQ,yDAAW;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,yDAAW;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAAsE;AACtE;AACA;AACA;AACA;AACA,SAAS;AACT,gCAAgC,gEAAkB;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,kEAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC","sources":["webpack:///./src/utils/utils.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./src/pages/popup.ts"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\n// Utility function to save the API key to Chrome storage\nexport function saveApiKey(apiKey) {\n    chrome.storage.local.set({ chatgptApiKey: apiKey }, () => { });\n}\n// Utility function to get the API key from Chrome storage\nexport function getApiKey(callback) {\n    chrome.storage.local.get(['chatgptApiKey'], (result) => {\n        callback(result.chatgptApiKey || null);\n    });\n}\n// Utility function to hide an element by selector\nexport function hideElement(selector) {\n    const element = document.querySelector(selector);\n    if (element) {\n        element.classList.add('hidden');\n    }\n}\n// Utility function to show an element by selector\nexport function showElement(selector) {\n    const element = document.querySelector(selector);\n    if (element) {\n        element.classList.remove('hidden');\n    }\n}\n// Utility function to get the domain name from a URL\nexport function getDomainNameFromUrl(url) {\n    const parts = url.hostname.split('.');\n    if (parts.length > 2) {\n        if (parts[parts.length - 2] === 'co' || parts[parts.length - 2] === 'com') {\n            return parts[parts.length - 3];\n        }\n        else {\n            return parts[parts.length - 2];\n        }\n    }\n    else if (parts.length === 2) {\n        return parts[0];\n    }\n    else {\n        return url.hostname;\n    }\n}\nexport function validateApiKey(apiKey) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const openaiEndpoint = 'https://api.openai.com/v1/models';\n        try {\n            const response = yield fetch(openaiEndpoint, {\n                method: 'GET',\n                headers: {\n                    'Authorization': `Bearer ${apiKey}`,\n                },\n            });\n            return response.status === 200;\n        }\n        catch (error) {\n            return false;\n        }\n    });\n}\n// Define the establishedSources variable\nconst establishedSources = [\n    'ad',\n    'apnews',\n    'bbc',\n    'cnn',\n    'fd',\n    'gelderlander',\n    'nos',\n    'nrc',\n    'nu',\n    'parool',\n    'telegraaf',\n    'trouw',\n    'volkskrant'\n];\n// Utility function to provide an additional sentence explaining the context of the analysis\nexport function getContextSentence(domain) {\n    if (establishedSources.includes(domain)) {\n        return \"contextSentence\";\n    }\n    ;\n    return \"\";\n}\nexport function analyseWithLLM(html) {\n    return __awaiter(this, void 0, void 0, function* () {\n        return new Promise((resolve, reject) => {\n            getApiKey((apiKey) => __awaiter(this, void 0, void 0, function* () {\n                if (!apiKey) {\n                    reject(new Error(chrome.i18n.getMessage('apiKeyNotSet')));\n                    return;\n                }\n                const prompt = `You are a news article classifier assessing whether a news article is fake news or not.\n\n                You should evaluate each news article on five content features:\n                emotionsFeature: Greater use of emotive and affective language. Especially negative emotions typically more present. In news, content contains heavy emotional appeal to readers, provoking fear, anger, outrage.\n                biasFeature: (Hyper-)partisan bias, often with a right-leaning ideological orientation. Negative references to left-leaning, progressive political actors or issues, positive references to (populist) right leaning political actors or issues.\n                informalLanguageFeature: More use of informal words and informal language (slang, swear). Higher likelihood of hate speech and incivility.\n                scientificConsensusFeature: Evidence and claims made go against conventional facts or scientific consensus.\n                expertMisuseFeature: Irrelevant or non-legitimate experts are cited who have no knowledge of the topic.\n\n                Give an assessment for each feature expressing to which extent a feature applies, use the following labels:\n                - notPresent\n                - somewhatPresent\n                - stronglyPresent\n                return the results as a pure JSON object listing each content feature the associated assesment and a brief explanation of the assesment in both dutch and english. The JSON object should have the following structure:\n                {\n                  \"emotionsFeature\": { \"assessment\": \"label\", \"dutchExplanation\": \"brief explanation\", \"englishExplanation\": \"brief explanation\" },\n                  \"biasFeature\": { \"assessment\": \"label\", \"dutchExplanation\": \"brief explanation\", \"englishExplanation\": \"brief explanation\" },\n                  \"informalLanguageFeature\": { \"assessment\": \"label\", \"dutchExplanation\": \"brief explanation\", \"englishExplanation\": \"brief explanation\" },\n                  \"scientificConsensusFeature\": { \"assessment\": \"label\", \"dutchExplanation\": \"brief explanation\", \"englishExplanation\": \"brief explanation\" },\n                  \"expertMisuseFeature\": { \"assessment\": \"label\", \"dutchExplanation\": \"brief explanation\", \"englishExplanation\": \"brief explanation\" }\n                }`;\n                const fullPrompt = `${prompt}\\n\\nHTML Content:\\n${html}`;\n                const openaiEndpoint = 'https://api.openai.com/v1/chat/completions';\n                const requestBody = {\n                    model: 'gpt-4o-mini',\n                    messages: [{ role: 'user', content: fullPrompt }],\n                    top_p: 0.01,\n                    seed: 1,\n                    response_format: {\n                        type: 'json_schema',\n                        json_schema: {\n                            name: 'news_article_analysis',\n                            schema: {\n                                type: 'object',\n                                properties: {\n                                    \"emotionsFeature\": {\n                                        type: 'object',\n                                        properties: {\n                                            assessment: { type: 'string', enum: ['notPresent', 'somewhatPresent', 'stronglyPresent'] },\n                                            dutchExplanation: { type: 'string' },\n                                            englishExplanation: { type: 'string' }\n                                        },\n                                        required: ['assessment', 'dutchExplanation', 'englishExplanation'],\n                                        additionalProperties: false\n                                    },\n                                    \"biasFeature\": {\n                                        type: 'object',\n                                        properties: {\n                                            assessment: { type: 'string', enum: ['notPresent', 'somewhatPresent', 'stronglyPresent'] },\n                                            dutchExplanation: { type: 'string' },\n                                            englishExplanation: { type: 'string' }\n                                        },\n                                        required: ['assessment', 'dutchExplanation', 'englishExplanation'],\n                                        additionalProperties: false\n                                    },\n                                    \"informalLanguageFeature\": {\n                                        type: 'object',\n                                        properties: {\n                                            assessment: { type: 'string', enum: ['notPresent', 'somewhatPresent', 'stronglyPresent'] },\n                                            dutchExplanation: { type: 'string' },\n                                            englishExplanation: { type: 'string' }\n                                        },\n                                        required: ['assessment', 'dutchExplanation', 'englishExplanation'],\n                                        additionalProperties: false\n                                    },\n                                    \"scientificConsensusFeature\": {\n                                        type: 'object',\n                                        properties: {\n                                            assessment: { type: 'string', enum: ['notPresent', 'somewhatPresent', 'stronglyPresent'] },\n                                            dutchExplanation: { type: 'string' },\n                                            englishExplanation: { type: 'string' }\n                                        },\n                                        required: ['assessment', 'dutchExplanation', 'englishExplanation'],\n                                        additionalProperties: false\n                                    },\n                                    \"expertMisuseFeature\": {\n                                        type: 'object',\n                                        properties: {\n                                            assessment: { type: 'string', enum: ['notPresent', 'somewhatPresent', 'stronglyPresent'] },\n                                            dutchExplanation: { type: 'string' },\n                                            englishExplanation: { type: 'string' }\n                                        },\n                                        required: ['assessment', 'dutchExplanation', 'englishExplanation'],\n                                        additionalProperties: false\n                                    }\n                                },\n                                required: [\n                                    \"emotionsFeature\",\n                                    \"biasFeature\",\n                                    \"informalLanguageFeature\",\n                                    \"scientificConsensusFeature\",\n                                    \"expertMisuseFeature\"\n                                ],\n                                additionalProperties: false\n                            },\n                            strict: true\n                        }\n                    }\n                };\n                try {\n                    const response = yield fetch(openaiEndpoint, {\n                        method: 'POST',\n                        headers: {\n                            'Content-Type': 'application/json',\n                            'Authorization': `Bearer ${apiKey}`,\n                        },\n                        body: JSON.stringify(requestBody),\n                    });\n                    if (!response.ok) {\n                        throw new Error(`HTTP error! status: ${response.status}`);\n                    }\n                    const data = yield response.json();\n                    resolve({\n                        content: data.choices[0].message.content,\n                        inputTokens: data.usage.prompt_tokens,\n                        outputTokens: data.usage.completion_tokens\n                    });\n                }\n                catch (error) {\n                    reject(new Error(chrome.i18n.getMessage('analysisError')));\n                }\n            }));\n        });\n    });\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { saveApiKey, getApiKey, hideElement, showElement, getDomainNameFromUrl, analyseWithLLM, validateApiKey, getContextSentence } from '../utils/utils';\ndocument.addEventListener('DOMContentLoaded', () => {\n    const popup = document.getElementById('news-analyser-popup');\n    // Initialize event listeners\n    initializeEventListeners();\n    // Localize HTML content\n    updateLocalizedContent();\n    // Update UI based on current state\n    updateUIForCurrentState();\n    // Prefill the API key if available and show relevant section\n    getApiKey((apiKey) => {\n        const apiKeyInput = popup.querySelector('#apiKeyInput');\n        if (apiKey) {\n            apiKeyInput.value = apiKey;\n        }\n        showRelevantSection();\n    });\n    function initializeEventListeners() {\n        popup.querySelector('#saveApiKeyButton').addEventListener('click', saveApiKeyHandler);\n        popup.querySelector('#resetApiKeyButton').addEventListener('click', resetApiKeyHandler);\n        popup.querySelector('#analyseButton').addEventListener('click', analyseButtonHandler);\n        popup.querySelector('#languageSelector').addEventListener('change', languageSelectorHandler);\n        // Add listener for info icon clicks\n        document.addEventListener('click', handleInfoIconClick);\n    }\n    function loadMessages(lang) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const response = yield fetch(chrome.runtime.getURL(`_locales/${lang}/messages.json`));\n            return yield response.json();\n        });\n    }\n    function getCustomMessage(messages, key) {\n        var _a;\n        return ((_a = messages[key]) === null || _a === void 0 ? void 0 : _a.message) || key;\n    }\n    function handleInfoIconClick(event) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const target = event.target;\n            if (target.classList.contains('info-icon')) {\n                event.stopPropagation();\n                const explanationBox = document.getElementById('explanationBox');\n                const lang = yield getCurrentLanguage();\n                const explanation = target.getAttribute(`data-explanation-${lang === 'nl' ? 'nl' : 'en'}`);\n                if (explanationBox && explanation) {\n                    explanationBox.textContent = explanation;\n                }\n                showElement('#explanationBox');\n            }\n        });\n    }\n    function getCurrentLanguage() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const data = yield chrome.storage.sync.get('language');\n            return data.language || chrome.i18n.getUILanguage();\n        });\n    }\n    function updateLocalizedContent() {\n        chrome.storage.sync.get('language', function () {\n            return __awaiter(this, void 0, void 0, function* () {\n                const lang = yield getCurrentLanguage();\n                loadMessages(lang).then((messages) => {\n                    popup.querySelectorAll('[data-i18n]').forEach(elem => {\n                        const key = elem.getAttribute('data-i18n');\n                        if (key)\n                            elem.textContent = getCustomMessage(messages, key);\n                    });\n                    popup.querySelectorAll('[data-i18n-placeholder]').forEach(elem => {\n                        const key = elem.getAttribute('data-i18n-placeholder');\n                        if (key)\n                            elem.placeholder = getCustomMessage(messages, key);\n                    });\n                    popup.querySelectorAll('[data-i18n-title]').forEach(elem => {\n                        const key = elem.getAttribute('data-i18n-title');\n                        if (key)\n                            elem.setAttribute('title', getCustomMessage(messages, key));\n                    });\n                    popup.querySelectorAll('[data-i18n-href]').forEach(elem => {\n                        const key = elem.getAttribute('data-i18n-href');\n                        if (key)\n                            elem.href = getCustomMessage(messages, key);\n                    });\n                    // Set the language selector to the current language\n                    const languageSelector = popup.querySelector('#languageSelector');\n                    if (languageSelector) {\n                        Array.from(languageSelector.options).forEach(option => {\n                            if (option.value === lang) {\n                                option.selected = true;\n                            }\n                        });\n                    }\n                    updateDynamicContent(messages);\n                });\n            });\n        });\n    }\n    function saveApiKeyHandler() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const apiKeyInput = popup.querySelector('#apiKeyInput');\n            const apiKey = apiKeyInput.value.trim();\n            const messageDiv = popup.querySelector('#message');\n            const saveButton = popup.querySelector('#saveApiKeyButton');\n            if (apiKey) {\n                saveButton.disabled = true;\n                const isValid = yield validateApiKey(apiKey);\n                if (isValid) {\n                    saveApiKey(apiKey);\n                    updateUIForAnalysis();\n                }\n                else {\n                    messageDiv.textContent = chrome.i18n.getMessage('invalidApiKey');\n                    updateLocalizedContent();\n                }\n                saveButton.disabled = false;\n            }\n        });\n    }\n    function resetApiKeyHandler() {\n        chrome.storage.local.remove('chatgptApiKey', () => {\n            updateUIForApiKeyInput();\n            popup.querySelector('#message').textContent = chrome.i18n.getMessage('apiKeyReset');\n        });\n    }\n    function languageSelectorHandler(event) {\n        const newLang = event.target.value;\n        chrome.storage.sync.set({ language: newLang }, function () {\n            updateLocalizedContent();\n            updateUIForCurrentState();\n        });\n    }\n    function analyseButtonHandler() {\n        const articlesContentDiv = popup.querySelector('#articlesContent');\n        hideElement('#articlesContent');\n        chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n            var _a;\n            const url = (_a = tabs[0].url) !== null && _a !== void 0 ? _a : \"\";\n            const selector = getSelectorByDomain(url);\n            if (!selector) {\n                showElement('#articlesContent');\n                articlesContentDiv.innerHTML = `<div>${chrome.i18n.getMessage('unsupportedWebsite')}</div>`;\n            }\n            else {\n                showElement('#loading');\n                chrome.tabs.sendMessage(tabs[0].id, { action: 'extractArticleContent', selector }, (response) => {\n                    if (response && response.content) {\n                        analyseWithLLM(response.content).then((result) => {\n                            hideElement('#loading');\n                            showElement('#articlesContent');\n                            if (result && result.content) {\n                                fillResultsTable(result, getDomainNameFromUrl(new URL(url)));\n                                updateLocalizedContent();\n                            }\n                            else {\n                                articlesContentDiv.innerHTML = `<div>${chrome.i18n.getMessage('emptyResponse')}</div>`;\n                            }\n                        }).catch((error) => {\n                            hideElement('#loading');\n                            showElement('#articlesContent');\n                            articlesContentDiv.innerHTML = `<div>${chrome.i18n.getMessage('analysisError', error.message)}</div>`;\n                        });\n                    }\n                    else {\n                        hideElement('#loading');\n                        showElement('#articlesContent');\n                        articlesContentDiv.innerHTML = `<div>${chrome.i18n.getMessage('extractionFailed')}</div>`;\n                    }\n                });\n            }\n        });\n    }\n    function showRelevantSection() {\n        getApiKey((apiKey) => {\n            if (apiKey) {\n                updateUIForAnalysis();\n            }\n            else {\n                updateUIForApiKeyInput();\n            }\n        });\n    }\n    function updateDynamicContent(messages) {\n        // Update table headers\n        const headers = popup.querySelectorAll('#daResultsTable th');\n        if (headers[0])\n            headers[0].textContent = getCustomMessage(messages, 'featureColumnHeader');\n        if (headers[1])\n            headers[1].textContent = getCustomMessage(messages, 'assessmentColumnHeader');\n        // Update feature names and assessments\n        const features = [\n            'emotionsFeature',\n            'biasFeature',\n            'informalLanguageFeature',\n            'scientificConsensusFeature',\n            'expertMisuseFeature'\n        ];\n        features.forEach(feature => {\n            const featureCell = popup.querySelector(`#daResultsTable td[data-feature=\"${feature}\"]`);\n            const assessmentCell = popup.querySelector(`#daResultsTable td[data-assessment=\"${feature}\"]`);\n            if (featureCell)\n                featureCell.textContent = getCustomMessage(messages, feature);\n            if (assessmentCell) {\n                const assessmentKey = assessmentCell.getAttribute('data-assessment-key');\n                if (assessmentKey) {\n                    const assessmentMessage = getCustomMessage(messages, assessmentKey);\n                    const infoIcon = assessmentCell.querySelector('.info-icon');\n                    // Preserve the info icon if it exists\n                    if (infoIcon) {\n                        assessmentCell.innerHTML = `${getSvgIcon(assessmentKey)} ${assessmentMessage} `;\n                        assessmentCell.appendChild(infoIcon);\n                    }\n                    else {\n                        assessmentCell.innerHTML = `${getSvgIcon(assessmentKey)} ${assessmentMessage}`;\n                    }\n                }\n            }\n        });\n        // Update explanation box\n        const explanationBox = popup.querySelector('#explanationBox');\n        if (explanationBox) {\n            const explanationKey = explanationBox.getAttribute('data-explanation-key');\n            if (explanationKey)\n                explanationBox.textContent = getCustomMessage(messages, explanationKey);\n        }\n        // Update context sentence\n        const contextParagraph = popup.querySelector('.context-sentence');\n        if (contextParagraph) {\n            const contextKey = contextParagraph.getAttribute('data-context-key');\n            if (contextKey)\n                contextParagraph.textContent = getCustomMessage(messages, contextKey);\n        }\n    }\n    function updateUIForCurrentState() {\n        getApiKey((apiKey) => {\n            if (apiKey) {\n                updateUIForAnalysis();\n            }\n            else {\n                updateUIForApiKeyInput();\n            }\n        });\n    }\n    function updateUIForAnalysis() {\n        hideElement('#apiKeySection');\n        showElement('#analysisSection');\n        updateLocalizedContent();\n    }\n    function updateUIForApiKeyInput() {\n        showElement('#apiKeySection');\n        hideElement('#analysisSection');\n    }\n    function getSvgIcon(assessmentKey) {\n        const svgIcons = {\n            'notPresent': '<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"#238823\" class=\"bi bi-circle-fill\"><circle cx=\"8\" cy=\"8\" r=\"8\"/></svg>',\n            'somewhatPresent': '<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"#FFBF00\" class=\"bi bi-circle-fill\"><circle cx=\"8\" cy=\"8\" r=\"8\"/></svg>',\n            'stronglyPresent': '<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"#D2222D\" class=\"bi bi-circle-fill\"><circle cx=\"8\" cy=\"8\" r=\"8\"/></svg>'\n        };\n        const k = assessmentKey;\n        return svgIcons[k] || '';\n    }\n    function fillResultsTable(data, domain) {\n        hideElement('#explanationBox');\n        const resultsTable = document.createElement('table');\n        resultsTable.id = 'daResultsTable';\n        resultsTable.innerHTML = `\n        <thead>\n            <tr>\n                <th data-i18n=\"featureColumnHeader\"></th>\n                <th data-i18n=\"assessmentColumnHeader\"></th>\n            </tr>\n        </thead>\n        <tbody></tbody>\n    `;\n        popup.querySelector('#articlesContent').appendChild(resultsTable);\n        const resultsTableTBody = resultsTable.getElementsByTagName('tbody')[0];\n        resultsTableTBody.innerHTML = ''; // Clear existing rows\n        const features = [\n            'emotionsFeature',\n            'biasFeature',\n            'informalLanguageFeature',\n            'scientificConsensusFeature',\n            'expertMisuseFeature'\n        ];\n        const parsedData = JSON.parse(data.content);\n        features.forEach(feature => {\n            const row = document.createElement('tr');\n            const featureCell = document.createElement('td');\n            const assessmentCell = document.createElement('td');\n            featureCell.setAttribute('data-feature', feature);\n            assessmentCell.setAttribute('data-assessment', feature);\n            const assessmentKey = parsedData[feature]['assessment'];\n            assessmentCell.setAttribute('data-assessment-key', assessmentKey);\n            const dutchExplanation = parsedData[feature]['dutchExplanation'];\n            const englishExplanation = parsedData[feature]['englishExplanation'];\n            // Create info icon\n            const infoIcon = document.createElement('span');\n            infoIcon.className = 'info-icon';\n            infoIcon.textContent = 'ℹ️';\n            infoIcon.setAttribute('data-explanation-nl', dutchExplanation);\n            infoIcon.setAttribute('data-explanation-en', englishExplanation);\n            assessmentCell.appendChild(document.createTextNode(' ')); // Add a space\n            assessmentCell.appendChild(infoIcon);\n            row.appendChild(featureCell);\n            row.appendChild(assessmentCell);\n            resultsTableTBody.appendChild(row);\n        });\n        const contextSentence = getContextSentence(domain);\n        if (contextSentence) {\n            const contextParagraph = document.createElement('p');\n            contextParagraph.setAttribute('data-context-key', contextSentence);\n            contextParagraph.className = 'context-sentence';\n            popup.querySelector('#articlesContent').appendChild(contextParagraph);\n        }\n        const cost = data.outputTokens * 0.0000006 + data.inputTokens * 0.00000015;\n    }\n    function getSelectorByDomain(url) {\n        const parsedUrl = new URL(url);\n        const domain = getDomainNameFromUrl(parsedUrl);\n        return getSelector(domain);\n    }\n    function getSelector(key) {\n        const selectors = {\n            ad: 'article.article',\n            apnews: 'bsp-story-page',\n            axed: '#article-blocks',\n            bbc: 'article',\n            cnn: 'article',\n            fd: 'div.grid',\n            foxnews: 'article',\n            frontnieuws: 'article',\n            geenstijl: 'main',\n            gedachtenvoer: 'article',\n            gelderlander: 'article.article',\n            jensen: 'article',\n            nbu: 'article.content',\n            niburu: 'div.com-content-article',\n            nieuwnieuws: 'div.app-container.article',\n            ninefornews: '#the-post',\n            nos: '#content',\n            nrc: 'article.vorm_article',\n            nu: '.blocks-container-article',\n            oann: 'article',\n            parool: 'article#article-content',\n            telegraaf: '#mainContent',\n            transitieweb: 'article',\n            trouw: 'article',\n            volkskrant: 'article'\n        };\n        return selectors[key];\n    }\n});\n"],"names":[],"sourceRoot":""}